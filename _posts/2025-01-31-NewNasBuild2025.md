---
layout: post
title: "50TB NAS Build with Jonsbo N2 and HexOS"
date: 2025-01-31
categories: [NAS, Storage, HomeLab]
tags: [jonsbo, hexos, nas, plex, immich, gpu]
---

{% include google-adsense.html %}

# 50TB Jonsbo N2 NAS Build

This guide covers building a 50TB NAS using the Jonsbo N2 case, installing HexOS (a TrueNAS-based platform), and setting up apps like Plex and Immich. We’ll also touch on GPU passthrough for Plex hardware transcoding.

## Hardware Overview

### Jonsbo N2 Case
- Supports five hot-swappable 3.5" HDDs.
- Compact design, ideal for NAS setups.
- Easy access drive bays for quick swaps.

### Motherboard & CPU
- Industrial mini-ITX board with Intel N100 CPU.
- 32GB DDR5 RAM to handle multiple containers and caching.

### Storage
- Five 10TB HDDs for a total raw capacity of 50TB.
- Two 2TB NVMe SSDs for fast I/O and caching.
- One dedicated 250GB SSD for HexOS (OS install).

### Power Supply
- SFX PSU with sufficient SATA and Molex connectors to power all HDDs.
- Ensure enough overhead wattage for CPU, drives, and future upgrades.

## Installing HexOS

1. **Create a Bootable USB**  
   - Use a tool like Rufus or balenaEtcher to flash the HexOS ISO onto a USB drive.
2. **Boot and Install**  
   - Enter your motherboard’s BIOS/UEFI and set the USB as the primary boot device.
   - Select the 250GB SSD as the install target.
   - Follow the on-screen prompts to complete installation.
3. **Initial Setup**  
   - Reboot into the HexOS interface.
   - Access the web UI via your NAS’s IP address to configure pools and shares.

## Creating Storage Pools and Shares

1. **Automatic Drive Detection**  
   - HexOS should auto-detect your five HDDs and any SSDs.
2. **Create a Pool**  
   - Go to the “Pools” or “Storage” section and create a new pool with your 5x 10TB drives.
   - Choose a RAID level that suits your redundancy/performance needs (e.g., RAIDZ2).
3. **Add Shares**  
   - Create SMB or NFS shares for network access.
   - Set permissions to allow user/group access as needed.

## Installing Plex and Immich

- In HexOS, go to the “Applications” or “Plugins” section.
- Locate **Plex** and **Immich** in the app catalog.
- Click **Install** and follow prompts to set up your library paths.
- Once installed, you can log in to Plex with your Plex account and to Immich with its default or configured credentials.

## Enabling GPU Passthrough for Plex

If you have a Plex Pass and want hardware transcoding:
1. **Check Intel iGPU Support**  
   - In HexOS, ensure the Intel iGPU drivers are installed or enabled by default.
2. **Enable Passthrough**  
   - In the VM/Container settings for Plex, look for a GPU passthrough or “device passthrough” option.
   - Assign the Intel iGPU to Plex.
3. **Confirm in Plex**  
   - In Plex Settings > Transcoder, check that “Use hardware acceleration when available” is enabled.

## One-Week Update: Handling SATA/NCQ Errors

After a week of use, some users may encounter intermittent SATA errors related to NCQ (Native Command Queuing). If you notice these, a temporary workaround in HexOS is to disable NCQ by passing an extra kernel option like `libata.force=noncq`.
I SSH'd into my nas and run the following command as root.

If you don't have a root user first become root:

```bash
sudo su
```

Then run the following command to disable NCQ:

```bash
midclt call system.advanced.update '{ "kernel_extra_options": "libata.force=noncq" }'
```

### What Does `libata.force=noncq` Do?

- **Disables NCQ:** Native Command Queuing allows drives to handle multiple read/write requests more efficiently.  
- **Possible Stability Improvement:** If your drives or controller exhibit NCQ-related errors (timeouts, dropped connections, etc.), forcing NCQ off can help.  
- **Potential Performance Impact:** Disabling NCQ might reduce performance on some workloads. However, if stability is your main goal, this workaround can be beneficial.

Consider this a troubleshooting measure. If disabling NCQ resolves the errors, you may want to check for firmware updates on your drives or any known compatibility issues that could allow you to safely re-enable NCQ later.




